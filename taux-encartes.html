<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Le taux de clients encartés</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #000;
      background-color: #fff;
      line-height: 1.6;
    }

    /* --- En-tête --- */
    header {
      position: relative;
      height: 400px;
      background-image: url('assets/images/Bannière%20index.jpg');
      background-size: cover;
      background-position: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
    }

    .logo-container {
      width: 320px;
      height: 320px;
      border-radius: 50%;
      background: linear-gradient(135deg, #FFA500, #FFD700, #8B4513);
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }

    .logo-container img {
      width: 90%;
      height: 90%;
      object-fit: contain;
      background-color: transparent;
    }

    .logo-text {
      text-align: center;
      margin-top: 16px;
      font-weight: bold;
      font-size: 1.6em;
      color: #FFA500;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    /* --- Menu --- */
    nav {
      background-color: white;
      padding: 12px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    nav ul {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      list-style: none;
      gap: 20px;
    }

    nav a {
      text-decoration: none;
      color: black;
      font-weight: 600;
      padding: 8px 12px;
      border-radius: 4px;
      transition: background 0.3s;
    }

    nav a:hover,
    nav a.active {
      background-color: #FFA500;
      color: white;
    }

    /* --- Contenu principal --- */
    main {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
      text-align: center;
    }

    main h1 {
      color: #FFA500;
      margin-bottom: 20px;
      font-size: 2.4em;
    }

    .infographie {
      margin: 20px auto 40px;
      max-width: 100%;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .infographie img {
      width: 100%;
      height: auto;
      display: block;
    }

    /* --- Styles pour les exercices --- */
    .clientsEncartes { color: #9400d3; font-weight: bold; }     /* Violet */
    .totalClients { color: #ff8c00; font-weight: bold; }       /* Orange */
    .tauxEncartes { color: #28a745; font-weight: bold; }       /* Vert */
    .correct-message { color: green; font-weight: bold; }
    .incorrect-message { color: red; font-weight: bold; }

    .exercise-section {
      max-width: 800px;
      margin: 0 auto 40px;
      text-align: left;
    }

    .formula {
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 8px;
    }

    .formula.clientsEncartes { background-color: #e6d7fa; border-left: 4px solid #9400d3; }
    .formula.totalClients { background-color: #ffe0b2; border-left: 4px solid #ff8c00; }
    .formula.tauxEncartes { background-color: #d4edda; border-left: 4px solid #28a745; }

    .exercise-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .exercise-card h2 {
      font-size: 1.4em;
      margin-bottom: 15px;
      color: #2c3e50;
    }

    #exercise-container {
      background-color: #f3e5f5;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    #student-answer {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1em;
      margin-bottom: 10px;
    }

    #check-answer, #new-exercise {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }

    #check-answer:hover { background-color: #2980b9; }
    #new-exercise:hover { background-color: #27ae60; }

    #result-container {
      display: none;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    #result-container.correct-answer { background-color: #d4edda; border: 1px solid #c3e6cb; }
    #result-container.incorrect-answer { background-color: #f8d7da; border: 1px solid #f5c6cb; }

    .precision-notice {
      color: red;
      font-style: italic;
      margin-top: 10px;
      font-size: 0.9em;
    }

    .progress-section {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .progress-section h2 {
      font-size: 1.4em;
      margin-bottom: 15px;
      color: #2c3e50;
    }

    .progress-bar-container {
      height: 20px;
      background-color: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
    }

    #progress-bar {
      height: 100%;
      background: linear-gradient(to right, #3498db, #2c3e50);
      width: 0%;
    }

    /* --- Tableau --- */
    .table-container {
      margin: 20px 0;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95em;
    }

    th, td {
      padding: 8px;
      text-align: center;
      border: 1px solid #ddd;
    }

    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    input.table-input {
      width: 100%;
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      text-align: center;
    }

    .total-row {
      font-weight: bold;
      background-color: #e9ecef;
    }

    /* --- Mobile --- */
    @media (max-width: 768px) {
      header {
        height: 300px;
      }
      .logo-container {
        width: 240px;
        height: 240px;
      }
      .logo-container img {
        width: 85%;
        height: 85%;
      }
      .logo-text {
        font-size: 1.3em;
      }
      main h1 {
        font-size: 2em;
      }
      .exercise-section,
      .progress-section {
        padding: 0 10px;
      }
      .table-container {
        font-size: 0.85em;
      }
    }
  </style>
</head>
<body>

  <!-- En-tête -->
  <header>
    <div class="logo-container">
      <img src="assets/images/logo.png" alt="Le prof de Vente">
    </div>
    <div class="logo-text">Le prof de Vente</div>
  </header>

  <!-- Menu -->
  <nav>
    <ul>
      <li><a href="index.html">Accueil</a></li>
      <li><a href="mcv.html">Le Bac Pro MCV</a></li>
      <li><a href="referentiel.html">Les 3 pôles</a></li>
      <li><a href="optionab.html">Option A & B</a></li>
      <li><a href="calculs.html">Calculs commerciaux</a></li>
      <li><a href="epreuves.html">Les Épreuves</a></li>
      <li><a href="actu.html">Actualités commerciales</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>

  <!-- Contenu -->
  <main>
    <h1>Le taux de clients encartés</h1>

    <!-- Infographie -->
    <div class="infographie">
      <img src="assets/images/tauxencartes.png" alt="Infographie : Le taux de clients encartés">
    </div>

    <!-- Formules -->
    <div class="exercise-section">
      <div class="exercise-card">
        <h2>Formules à connaître</h2>
        <div class="formula tauxEncartes">
          <p><span class="tauxEncartes">Taux de clients encartés</span> = (<span class="clientsEncartes">Nombre de clients encartés</span> ÷ <span class="totalClients">Nombre total de clients</span>) × 100</p>
        </div>
        <div class="formula clientsEncartes">
          <p><span class="clientsEncartes">Nombre de clients encartés</span> = <span class="totalClients">Nombre total de clients</span> × <span class="tauxEncartes">Taux de clients encartés</span></p>
        </div>
      </div>

      <!-- Exercice interactif -->
      <div class="exercise-card">
        <h2>Exercice interactif</h2>
        <select id="difficulty" class="px-3 py-2 border rounded mb-3">
          <option value="easy">Facile (formule 1)</option>
          <option value="medium">Moyen (formules 1 et 2)</option>
          <option value="hard">Difficile (formules 1 et 2)</option>
        </select>
        <div id="exercise-container">
          <p id="exercise-text" class="mb-2"></p>
          <input type="text" id="student-answer" placeholder="Votre réponse (ex: 20,00%)" class="border rounded px-3 py-2 w-full mb-2">
          <button id="check-answer" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Vérifier</button>
          <div id="dynamic-instruction" class="mt-2 text-sm"></div>
        </div>
        <div id="result-container">
          <p id="result-text"></p>
          <div id="correction-details" class="mt-2"></div>
        </div>
        <button id="new-exercise">Nouvel exercice</button>
      </div>

      <!-- Progression -->
      <div class="progress-section">
        <h2>Votre progression</h2>
        <div class="progress-bar-container">
          <div id="progress-bar"></div>
        </div>
        <div class="flex justify-between text-sm">
          <p>Exercices réussis: <span id="correct-count">0</span></p>
          <p>Exercices tentés: <span id="total-count">0</span></p>
        </div>
      </div>
    </div>
  </main>

  <!-- Script JS -->
  <script>
    let correctAnswers = 0;
    let totalAttempts = 0;

    function formatToTwoDecimals(num) {
        return num.toFixed(2).replace('.', ',');
    }

    function generateExercise() {
        const difficulty = document.getElementById('difficulty').value;
        let exerciseText = '';
        let answer = 0;
        let isCalculatingClients = false;

        if (difficulty === 'easy') {
            // Formule 1 uniquement → calcul du taux de clients encartés
            const clientsEncartes = Math.floor(Math.random() * 90) + 10; // 10 à 100
            const totalClients = Math.floor(Math.random() * 100) + clientsEncartes + 10; // > clientsEncartes
            answer = (clientsEncartes / totalClients) * 100;
            exerciseText = `Un magasin a ${clientsEncartes} clients encartés sur un total de ${totalClients} clients. Calculez le taux de clients encartés.`;
            isCalculatingClients = false;
        } else {
            // 50 % de chances d'utiliser la formule 2
            const useFormula2 = Math.random() > 0.5;
            if (useFormula2) {
                const totalClients = Math.floor(Math.random() * 100) + 50; // 50 à 150
                const tauxEncartes = parseFloat((Math.random() * 40 + 10).toFixed(2)); // 10% à 50%
                const clientsEncartes = totalClients * (tauxEncartes / 100);
                answer = Math.round(clientsEncartes); // entier
                exerciseText = `Un magasin a un taux de clients encartés de ${formatToTwoDecimals(tauxEncartes)}% et un total de ${totalClients} clients. Calculez le nombre de clients encartés.`;
                isCalculatingClients = true;
            } else {
                const clientsEncartes = Math.floor(Math.random() * 90) + 10;
                const totalClients = Math.floor(Math.random() * 100) + clientsEncartes + 10;
                answer = (clientsEncartes / totalClients) * 100;
                exerciseText = `Un magasin a ${clientsEncartes} clients encartés sur un total de ${totalClients} clients. Calculez le taux de clients encartés.`;
                isCalculatingClients = false;
            }
        }

        document.getElementById('exercise-text').textContent = exerciseText;
        document.getElementById('student-answer').value = '';
        document.getElementById('result-container').style.display = 'none';
        currentAnswer = Number(answer.toFixed(2));

        // ✅ Affichage de la consigne dynamique
        const instructionDiv = document.getElementById('dynamic-instruction');
        if (isCalculatingClients) {
            instructionDiv.innerHTML = '<p class="text-red-600 italic">Arrondir le résultat à l’entier le plus proche.</p>';
        } else {
            instructionDiv.innerHTML = '<p class="text-red-600 italic">Arrondir le taux à 2 chiffres après la virgule.</p>';
        }

        // ✅ Stocke la variable pour la vérification
        currentExercise = {
            isCalculatingClients: isCalculatingClients
        };
    }

    let currentAnswer = 0;
    let currentExercise = null;

    function checkAnswer() {
        const studentAnswerInput = document.getElementById('student-answer').value.trim();
        const resultContainer = document.getElementById('result-container');
        const resultText = document.getElementById('result-text');

        if (studentAnswerInput === '') {
            alert("Veuillez entrer une réponse.");
            return;
        }

        totalAttempts++;

        // Vérifie si c'est un pourcentage ou un nombre entier
        const isPercentage = studentAnswerInput.includes('%');
        let studentValue;

        if (isPercentage) {
            const clean = studentAnswerInput.replace('%', '').replace(' ', '').replace(',', '.');
            studentValue = parseFloat(clean);
        } else {
            studentValue = parseFloat(studentAnswerInput.replace(',', '.'));
        }

        if (isNaN(studentValue)) {
            resultText.innerHTML = "<span class='incorrect-message'>Format invalide.</span>";
            resultContainer.style.display = 'block';
            return;
        }

        const isFormula2 = currentExercise.isCalculatingClients;
        let isCorrect = false;

        if (isFormula2) {
            // Réponse attendue : nombre entier (clients encartés)
            isCorrect = Math.abs(studentValue - currentAnswer) < 0.5;
        } else {
            // Réponse attendue : pourcentage (taux de clients encartés)
            isCorrect = Math.abs(studentValue - currentAnswer) < 0.01;
        }

        resultContainer.style.display = 'block';
        if (isCorrect) {
            resultText.innerHTML = "<span class='correct-message'>✅ Bravo !</span>";
            correctAnswers++;
        } else {
            if (isFormula2) {
                // ✅ Message en "clients"
                resultText.innerHTML = `<span class='incorrect-message'>❌ Faux. La bonne réponse est ${Math.round(currentAnswer)} clients.</span>`;
            } else {
                // ✅ Message en "%"
                resultText.innerHTML = `<span class='incorrect-message'>❌ Faux. La bonne réponse est ${formatToTwoDecimals(currentAnswer)}%.</span>`;
            }
        }

        updateProgress();
    }

    function updateProgress() {
        const progressBar = document.getElementById('progress-bar');
        const correctCount = document.getElementById('correct-count');
        const totalCount = document.getElementById('total-count');
        const progressPercentage = totalAttempts > 0 ? Math.round((correctAnswers / totalAttempts) * 100) : 0;
        progressBar.style.width = `${progressPercentage}%`;
        correctCount.textContent = correctAnswers;
        totalCount.textContent = totalAttempts;
    }

    // Event listeners
    document.getElementById('check-answer').addEventListener('click', checkAnswer);
    document.getElementById('new-exercise').addEventListener('click', generateExercise);
    document.getElementById('difficulty').addEventListener('change', generateExercise);

    generateExercise();
  </script>

</body>
</html>
