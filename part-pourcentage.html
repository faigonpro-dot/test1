<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Les parts en %</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #000;
      background-color: #fff;
      line-height: 1.6;
    }

    /* --- En-tête --- */
    header {
      position: relative;
      height: 400px;
      background-image: url('assets/images/Bannière%20index.jpg');
      background-size: cover;
      background-position: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-bottom: 20px;
    }

    .logo-container {
      width: 320px;
      height: 320px;
      border-radius: 50%;
      background: linear-gradient(135deg, #FFA500, #FFD700, #8B4513);
      display: flex;
      justify-content: center;
      align-items: center;
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }

    .logo-container img {
      width: 90%;
      height: 90%;
      object-fit: contain;
      background-color: transparent;
    }

    .logo-text {
      text-align: center;
      margin-top: 16px;
      font-weight: bold;
      font-size: 1.6em;
      color: #FFA500;
      text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    /* --- Menu --- */
    nav {
      background-color: white;
      padding: 12px 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    nav ul {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      list-style: none;
      gap: 20px;
    }

    nav a {
      text-decoration: none;
      color: black;
      font-weight: 600;
      padding: 8px 12px;
      border-radius: 4px;
      transition: background 0.3s;
    }

    nav a:hover,
    nav a.active {
      background-color: #FFA500;
      color: white;
    }

    /* --- Contenu principal --- */
    main {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
      text-align: center;
    }

    main h1 {
      color: #FFA500;
      margin-bottom: 20px;
      font-size: 2.4em;
    }

    .infographie {
      margin: 20px auto 40px;
      max-width: 100%;
      border-radius: 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .infographie img {
      width: 100%;
      height: auto;
      display: block;
    }

    /* --- Styles pour les exercices --- */
    .partNombre { color: #28a745; font-weight: bold; }     /* Vert */
    .total { color: #007bff; font-weight: bold; }          /* Bleu */
    .partPct { color: #28a745; font-weight: bold; }        /* Vert */
    .correct-message { color: green; font-weight: bold; }
    .incorrect-message { color: red; font-weight: bold; }

    .exercise-section {
      max-width: 800px;
      margin: 0 auto 40px;
      text-align: left;
    }

    .formula {
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 8px;
    }

    .formula.partNombre { background-color: #d4edda; border-left: 4px solid #28a745; }
    .formula.total { background-color: #dbeafe; border-left: 4px solid #007bff; }
    .formula.partPct { background-color: #d4edda; border-left: 4px solid #28a745; }

    .exercise-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .exercise-card h2 {
      font-size: 1.4em;
      margin-bottom: 15px;
      color: #2c3e50;
    }

    #exercise-container {
      background-color: #f3e5f5;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    #student-answer {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1em;
      margin-bottom: 10px;
    }

    #check-answer, #new-exercise {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }

    #check-answer:hover { background-color: #2980b9; }
    #new-exercise:hover { background-color: #27ae60; }

    #result-container {
      display: none;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    #result-container.correct-answer { background-color: #d4edda; border: 1px solid #c3e6cb; }
    #result-container.incorrect-answer { background-color: #f8d7da; border: 1px solid #f5c6cb; }

    .precision-notice {
      color: red;
      font-style: italic;
      margin-top: 10px;
      font-size: 0.9em;
    }

    .progress-section {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .progress-section h2 {
      font-size: 1.4em;
      margin-bottom: 15px;
      color: #2c3e50;
    }

    .progress-bar-container {
      height: 20px;
      background-color: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
      margin: 10px 0;
    }

    #progress-bar {
      height: 100%;
      background: linear-gradient(to right, #3498db, #2c3e50);
      width: 0%;
    }

    /* --- Tableau --- */
    .table-container {
      margin: 20px 0;
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95em;
    }

    th, td {
      padding: 8px;
      text-align: center;
      border: 1px solid #ddd;
    }

    th {
      background-color: #f2f2f2;
      font-weight: bold;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    input.table-input {
      width: 100%;
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      text-align: center;
    }

    .total-row {
      font-weight: bold;
      background-color: #e9ecef;
    }

    /* --- Mobile --- */
    @media (max-width: 768px) {
      header {
        height: 300px;
      }
      .logo-container {
        width: 240px;
        height: 240px;
      }
      .logo-container img {
        width: 85%;
        height: 85%;
      }
      .logo-text {
        font-size: 1.3em;
      }
      main h1 {
        font-size: 2em;
      }
      .exercise-section,
      .progress-section {
        padding: 0 10px;
      }
      .table-container {
        font-size: 0.85em;
      }
    }
  </style>
</head>
<body>

  <!-- En-tête -->
  <header>
    <div class="logo-container">
      <img src="assets/images/logo.png" alt="Le prof de Vente">
    </div>
    <div class="logo-text">Le prof de Vente</div>
  </header>

  <!-- Menu -->
  <nav>
    <ul>
      <li><a href="index.html">Accueil</a></li>
      <li><a href="mcv.html">Le Bac Pro MCV</a></li>
      <li><a href="referentiel.html">Les 3 pôles</a></li>
      <li><a href="optionab.html">Option A & B</a></li>
      <li><a href="calculs.html">Calculs commerciaux</a></li>
      <li><a href="epreuves.html">Les Épreuves</a></li>
      <li><a href="actu.html">Actualités commerciales</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </nav>

  <!-- Contenu -->
  <main>
    <h1>Les parts en %</h1>

    <!-- Infographie -->
    <div class="infographie">
      <img src="assets/images/partpourcentage.png" alt="Infographie : Les parts en %">
    </div>

    <!-- Formules -->
    <div class="exercise-section">
      <div class="exercise-card">
        <h2>Formule à connaître</h2>
        <div class="formula partPct">
          <p><span class="partPct">Part en %</span> = (<span class="partNombre">Part en nombre</span> ÷ <span class="total">Total</span>) × 100</p>
        </div>
      </div>

      <!-- Exercice interactif -->
      <div class="exercise-card">
        <h2>Exercice interactif</h2>
        <select id="difficulty" class="px-3 py-2 border rounded mb-3">
          <option value="easy">Facile (un seul calcul)</option>
          <option value="medium">Moyen (tableau - nombres entiers)</option>
          <option value="hard">Difficile (tableau - nombres décimaux)</option>
        </select>
        <div id="exercise-container"></div>
        <p class="precision-notice">
          Les résultats attendus devront être arrondis à 2 chiffres après la virgule, même pour les nombres entiers : 20 % → 20,00 %.
        </p>
        <button id="new-exercise">Nouvel exercice</button>
      </div>

      <!-- Progression -->
      <div class="progress-section">
        <h2>Votre progression</h2>
        <div class="progress-bar-container">
          <div id="progress-bar"></div>
        </div>
        <div class="flex justify-between text-sm">
          <p>Exercices réussis: <span id="correct-count">0</span></p>
          <p>Exercices tentés: <span id="total-count">0</span></p>
        </div>
      </div>
    </div>
  </main>

  <!-- Script JS -->
  <script>
    let correctAnswers = 0;
    let totalAttempts = 0;

    // Liste des familles de produits
    const productFamilies = [
      {
        name: "Prêt-à-porter",
        products: ["Tee-shirt", "Pull", "Chaussettes", "Pantalon", "Robe", "Veste", "Écharpe", "Bonnet", "Gants", "Jupe"]
      },
      {
        name: "Alimentaire",
        products: ["Pain", "Lait", "Fromage", "Yaourt", "Jambon", "Œufs", "Pâtes", "Riz", "Conserves", "Biscuits"]
      },
      {
        name: "Électroménager",
        products: ["Réfrigérateur", "Lave-linge", "Four", "Micro-ondes", "Aspirateur", "Cafetière", "Grille-pain", "Mixer", "Ventilateur", "Sèche-cheveux"]
      },
      {
        name: "High-tech",
        products: ["Smartphone", "Tablette", "Ordinateur", "Casque", "Clavier", "Souris", "Disque dur", "Chargeur", "Écouteurs", "Routeur"]
      },
      {
        name: "Jouets",
        products: ["Poupée", "Lego", "Voiture", "Dinosaure", "Ballon", "Puzzle", "Jeux vidéo", "Peluche", "Trotteur", "Trampoline"]
      },
      {
        name: "Beauté & Hygiène",
        products: ["Shampoing", "Gel douche", "Dentifrice", "Rasoir", "Crème", "Maquillage", "Déodorant", "Brosse à dents", "Serviette", "Parfum"]
      },
      {
        name: "Maison & Jardin",
        products: ["Balai", "Seau", "Arrosoir", "Bêche", "Râteau", "Plante", "Pot de fleur", "Coussin", "Nappe", "Assiette"]
      },
      {
        name: "Sport & Loisirs",
        products: ["Raquette", "Ballon", "Tennis", "Pagaie", "Tapis de yoga", "Sac à dos", "Montre", "Gourde", "Chaussures", "Short"]
      }
    ];

    let currentExercise = null;

    function getRandomNumber(min, max, useDecimals = false) {
        const num = Math.random() * (max - min) + min;
        return useDecimals ? Number(num.toFixed(2)) : Math.round(num);
    }

    function formatToTwoDecimals(num) {
        return num.toFixed(2).replace('.', ',');
    }

    function getRandomFamily() {
        const index = Math.floor(Math.random() * productFamilies.length);
        return productFamilies[index];
    }

    function generateExercise() {
        const difficulty = document.getElementById('difficulty').value;
        const container = document.getElementById('exercise-container');
        container.innerHTML = '';

        if (difficulty === 'easy') {
            const family = getRandomFamily();
            const product = family.products[Math.floor(Math.random() * family.products.length)];
            const part = getRandomNumber(10, 100, false);
            const total = getRandomNumber(part, 200, false);
            const answer = (part / total) * 100;
            currentExercise = {
                type: 'easy',
                part,
                total,
                answer: parseFloat(answer.toFixed(2)),
                familyName: family.name,
                productName: product
            };

            container.innerHTML = `
                <p class="mb-2">${part} ${product} ont été vendus sur les ${total} ${family.name.toLowerCase()} vendus au total. Calculez la part en %.</p>
                <input type="text" id="student-answer" placeholder="Votre réponse (ex: 20,00%)" class="border rounded px-3 py-2 w-full mb-2">
                <button id="check-answer" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Vérifier</button>
                <div id="result-container" class="hidden mt-3 p-3 rounded"></div>
            `;
        } else {
    const useDecimals = difficulty === 'hard';
    const family = getRandomFamily();
    
    // ✅ Sélectionner 3 produits UNIQUES
    const shuffledProducts = [...family.products].sort(() => 0.5 - Math.random());
    const selectedProducts = shuffledProducts.slice(0, 3); // 3 produits différents

    const products = [];
    let totalQty = 0;
    for (let i = 0; i < 3; i++) {
        // ✅ Quantités toujours entières, même en mode "hard"
        const qty = getRandomNumber(10, 100, false); // false = entier
        products.push({ name: selectedProducts[i], qty });
        totalQty += qty;
    }
    products.forEach(p => {
        p.pct = (p.qty / totalQty) * 100;
    });

    currentExercise = {
        type: 'table',
        products,
        totalQty, // gardé en mémoire pour la correction
        useDecimals: false, // les quantités sont toujours entières
        familyName: family.name
    };

    let tableHTML = `
        <p class="mb-2">Complétez le tableau ci-dessous. Calculez d'abord le total des quantités vendues, puis les parts en %.</p>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>Désignation</th><th>Quantité vendue</th><th>Part en %</th></tr>
                </thead>
                <tbody>
    `;
    products.forEach((p, i) => {
        // ✅ Affichage des quantités SANS décimales → juste l'entier
        tableHTML += `
            <tr>
                <td>${p.name}</td>
                <td>${p.qty}</td>
                <td><input type="text" class="table-input" data-index="${i}" placeholder="%"></td>
            </tr>
        `;
    });
    tableHTML += `
                <tr class="total-row">
                    <td>Total</td>
                    <td><input type="number" id="total-input" placeholder="?" min="1" class="w-full text-center border rounded p-1"></td>
                    <td id="total-pct">0,00%</td>
                </tr>
            </tbody>
            </table>
        </div>
        <button id="check-answer" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded mt-2">Vérifier</button>
        <div id="result-container" class="hidden mt-3 p-3 rounded"></div>
    `;

    container.innerHTML = tableHTML;

    // Mise à jour du total % quand les parts changent
    document.querySelectorAll('.table-input').forEach(input => {
        input.addEventListener('input', () => {
            let sum = 0;
            document.querySelectorAll('.table-input').forEach(i => {
                const v = i.value.trim();
                if (v && v.endsWith('%')) {
                    const n = parseFloat(v.replace('%', '').replace(',', '.'));
                    if (!isNaN(n)) sum += n;
                }
            });
            document.getElementById('total-pct').textContent = `${sum.toFixed(2).replace('.', ',')}%`;
        });
    });
}

        document.getElementById('check-answer')?.addEventListener('click', checkAnswer);
    }

    function checkAnswer() {
    const resultContainer = document.getElementById('result-container');
    resultContainer.style.display = 'block';
    totalAttempts++;

    if (currentExercise.type === 'easy') {
        // ... (inchangé)
    } else {
        // ✅ Récupérer la saisie du total
        const totalInput = document.getElementById('total-input')?.value.trim();
        const totalStudent = totalInput ? parseInt(totalInput) : null;
        const totalCorrect = currentExercise.totalQty;

        // ✅ Vérifier les parts
        const inputs = document.querySelectorAll('.table-input');
        let allPartsValid = true;
        let missingPercent = false;
        const answers = [];

        inputs.forEach(i => {
            const v = i.value.trim();
            if (!v) {
                allPartsValid = false;
            } else if (!v.endsWith('%')) {
                allPartsValid = false;
                missingPercent = true;
            } else {
                const clean = v.replace('%', '').replace(' ', '');
                const n = parseFloat(clean.replace(',', '.'));
                if (isNaN(n)) allPartsValid = false;
                else answers.push(n);
            }
        });

        // ✅ Vérification globale
        const totalCorrectAnswer = (totalStudent === totalCorrect);
        const partsCorrect = allPartsValid && answers.length === 3 && 
            answers.every((a, i) => Math.abs(a - currentExercise.products[i].pct) < 0.01);

        if (totalCorrectAnswer && partsCorrect) {
            resultContainer.innerHTML = '<span class="correct-message">✅ Bravo ! Tout est correct.</span>';
            correctAnswers++;
        } else {
            let message = '<span class="incorrect-message">❌ ';
            if (!totalCorrectAnswer) {
                message += 'Le total des quantités est incorrect. ';
            }
            if (!allPartsValid) {
                if (missingPercent) {
                    message += 'N’oubliez pas le symbole % dans les parts. ';
                } else {
                    message += 'Vérifiez vos parts en %. ';
                }
            }
            message += '</span>';
            resultContainer.innerHTML = message;
        }
    }

    updateProgress();
}

    function updateProgress() {
        const progress = totalAttempts > 0 ? Math.round((correctAnswers / totalAttempts) * 100) : 0;
        document.getElementById('progress-bar').style.width = `${progress}%`;
        document.getElementById('correct-count').textContent = correctAnswers;
        document.getElementById('total-count').textContent = totalAttempts;
    }

    document.getElementById('difficulty').addEventListener('change', generateExercise);
    document.getElementById('new-exercise').addEventListener('click', generateExercise);

    generateExercise();
  </script>

</body>
</html>
